.. _tutorial_iter_write:

Iterative and Streaming Data Write
==================================

Using ```DataChunkIterator```
-----------------------------

.. note::

    TODO Add example illustrating the use of DataChunkIterator


HDF5 I/O
^^^^^^^^

The HDF5 I/O backend implemented in the FORM library, currently handles
iterative/steaming writes in sequence, i.e., they are written one-at-a-time
one-after-the-other, rather than simultaneously.

.. note::

    TODO add discussion on the use of chunking (and compression) on write

Data acquistion
---------------

In the NWB format, *TimeSeries* provides two time objects representations.
The first, *timestamps*, stores time information that is corrected
to the experiment's time base (i.e.,aligned to a master clock,
with time-zero aligned to the starting time of the experiment).
This field is used for data processing and
subsequent scientific analysis. The second, *sync*, is an optional group
that can be used to store the sample times as reported by the
acquisition/stimulus hardware, before samples are converted to a common
timebase and corrected relative to the master clock. This approach
allows the NWB format to support streaming of data directly from
hardware sources.


Option 1: Streaming data to external HDF5
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

*TimeSeries* support the integration of data stored in external HDF5 files with NWB data files via
external links. This makes it possible to stream data to custom HDF5 files and to
afterwards link the data into and NWB file.

When data is streamed from experiment hardware to an external HDF5 file, the data should be stored in an
HDF5 dataset that has the same attributes as the *data* dataset of *TimeSeries*  (with time information
stored as necessary). This allows the raw data files to be separate
file-system objects that can be set as read-only once the experiment is
complete. *TimeSeries* objects in /acquisition will then link to the *data*
field in the "raw" time series generated by the acquisition system.
The uncorrected time generated by the acuqistion system can be stored (or linked) in the *sync* group.
of the *TimeSeries*. In the NWB format, hardware-recorded time data
must then be corrected to a common time base (e.g., timestamps from all hardware
sources aligned) before it can be included in the *timestamps* of the *TimeSeries*.

.. note::

    TODO Add brief example showing how we can link to external HDF5 files using PyNWB

Option 2: Streaming data directly to NWB
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. note::

    TODO Add discussion about this option



